<!DOCTYPE html>
<html>
<head>
  <title>Google Map with CSV Markers</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAddDhOf_WnkBURDV-InfF-_19FaNZNhmc"></script>
  <script>
    // Pre-stored hash of the password 'portalai1'
    const storedPasswordHash = 'efed16cc1c56f9533d25600f9846a179263db5f7b8b3ffb60ad2daef44d4dbfc';

    // Initialize the Google Map
    let map;

    // Function to initialize the map
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 54.9, lng: 24 }, // Center on lat: 54.9, lng: 24
        zoom: 12, // Default zoom level
      });

      // Load markers automatically
      loadMarkersFromCSV();
    }

    // Function to load markers from CSV input
    function loadMarkersFromCSV() {
      const csvInput = `
koldunas,54.893197,23.9970201
nepawytas,54.900619,23.893634
eimantas,54.893909,23.93126
knitsfire,54.929617,23.943835
dwarfas,54.905952,23.922887
zmogas,54.889045,23.926626
veidalol,54.901249,23.929018
cookiez,54.901582,23.928149
davolna,54.858178,23.911006
geokatinas,54.925060,23.975543
tomuko,54.928966,23.996491
andriust,54.895326,23.954344
statybininkas,54.866659,23.943685
      `;

      try {
        const lines = csvInput.trim().split("\n");
        lines.forEach(line => {
          const [caption, lat, lon] = line.split(",");

          if (caption && !isNaN(lat) && !isNaN(lon)) {
            const position = { lat: parseFloat(lat), lng: parseFloat(lon) };

            const marker = new google.maps.Marker({
              position,
              map,
              title: caption, // Marker tooltip
            });

            const label = new CustomLabel(marker, caption);
            label.setMap(map);
          }
        });

        console.log("Markers loaded successfully!");
      } catch (error) {
        console.error("CSV Parsing Error:", error);
      }
    }

    // Custom label to display text next to the marker
    class CustomLabel extends google.maps.OverlayView {
      constructor(marker, text) {
        super();
        this.marker = marker;
        this.text = text;
        this.div = null;
      }

      onAdd() {
        const div = document.createElement("div");
        div.style.position = "absolute";
        div.style.backgroundColor = "white";
        div.style.padding = "2px 8px";
        div.style.borderRadius = "3px";
        div.style.fontSize = "14px";
        div.style.color = "black";
        div.style.fontWeight = "bold";
        div.innerText = this.text;

        this.div = div;
        const panes = this.getPanes();
        panes.overlayLayer.appendChild(div);
      }

      draw() {
        const position = this.getProjection().fromLatLngToDivPixel(this.marker.getPosition());
        const div = this.div;

        if (div) {
          div.style.left = position.x + "px";
          div.style.top = position.y - 25 + "px"; // Adjust the label's position
        }
      }

      onRemove() {
        if (this.div) {
          this.div.parentNode.removeChild(this.div);
        }
      }
    }

    // Function to hash a password with SHA-256
    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // Ask for password and verify it
    (async function() {
      const enteredPassword = prompt("Enter password to view this page:");
      const enteredPasswordHash = await hashPassword(enteredPassword);

      if (enteredPasswordHash !== storedPasswordHash) {
        document.body.innerHTML = '<h1>Access Denied</h1>';
      } else {
        // Proceed with loading the map
        initMap();
      }
    })();
  </script>
</head>
<body>
  <h1>Google Map with CSV Markers</h1>

  <div id="map" style="height: 500px; width: 100%; margin-top: 20px;"></div>
</body>
</html>
